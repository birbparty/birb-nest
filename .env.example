# Birb Nest Persistent Cache Service Configuration
# Copy this file to .env and update values as needed

# ===== PostgreSQL Configuration =====
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_USER=birb
POSTGRES_PASSWORD=birbpass
POSTGRES_DB=birbcache
# Connection pool settings
POSTGRES_MAX_CONNS=25
POSTGRES_MIN_CONNS=5

# ===== Redis Configuration =====
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
# Cache TTL settings (in seconds)
REDIS_DEFAULT_TTL=3600
REDIS_MAX_TTL=86400
# Connection pool settings
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=5
REDIS_MAX_RETRIES=3

# ===== NATS Configuration =====
NATS_URL=nats://birb:birbpass@localhost:4222
NATS_USER=birb
NATS_PASSWORD=birbpass
NATS_PORT=4222
NATS_MONITOR_PORT=8222
# JetStream settings
NATS_STREAM_NAME=BIRB_CACHE
NATS_CONSUMER_NAME=birb-worker
NATS_MAX_PENDING=1000
NATS_ACK_WAIT=30s
# DLQ settings
NATS_DLQ_MAX_RETRIES=3
NATS_DLQ_STREAM_NAME=BIRB_CACHE_DLQ

# ===== API Service Configuration =====
API_HOST=0.0.0.0
API_PORT=8080
API_DEBUG_PORT=2345
# Rate limiting
API_RATE_LIMIT_REQUESTS=100
API_RATE_LIMIT_DURATION=1m
# Request timeouts
API_READ_TIMEOUT=10s
API_WRITE_TIMEOUT=10s
API_IDLE_TIMEOUT=120s
# CORS settings
API_CORS_ALLOWED_ORIGINS=*
API_CORS_ALLOWED_METHODS=GET,POST,PUT,DELETE,OPTIONS
API_CORS_ALLOWED_HEADERS=Content-Type,Authorization

# ===== Worker Service Configuration =====
WORKER_REPLICAS=2
WORKER_DEBUG_PORT=2346
WORKER_BATCH_SIZE=100
WORKER_BATCH_TIMEOUT=1s
WORKER_CONSUMER_GROUP=birb-workers
# Rehydration settings
WORKER_REHYDRATION_BATCH_SIZE=1000
WORKER_REHYDRATION_INTERVAL=5m
WORKER_REHYDRATION_PRIORITY_THRESHOLD=0.8

# ===== Observability Configuration =====
LOG_LEVEL=info
LOG_FORMAT=json
# OpenTelemetry
OTEL_EXPORTER_OTLP_ENDPOINT=http://localhost:4317
OTEL_SERVICE_NAME=birb-nest
OTEL_TRACES_ENABLED=true
OTEL_METRICS_ENABLED=true
OTEL_LOGS_ENABLED=true
# Datadog (optional)
DATADOG_ENABLED=false
DATADOG_API_KEY=
DATADOG_APP_KEY=
DATADOG_SITE=datadoghq.com

# ===== Development Tools Configuration =====
# pgAdmin
PGADMIN_EMAIL=admin@birb.party
PGADMIN_PASSWORD=admin
# Grafana
GRAFANA_USER=admin
GRAFANA_PASSWORD=admin
# Air hot reload
AIR_ENABLED=true

# ===== Performance Tuning =====
# Go runtime
GOMAXPROCS=0
GOMEMLIMIT=0
# Circuit breaker
CIRCUIT_BREAKER_TIMEOUT=10s
CIRCUIT_BREAKER_MAX_REQUESTS=10
CIRCUIT_BREAKER_INTERVAL=1m
CIRCUIT_BREAKER_FAILURE_RATIO=0.5

# ===== Feature Flags =====
FEATURE_BATCH_WRITES=true
FEATURE_ASYNC_DELETES=true
FEATURE_CACHE_WARMING=true
FEATURE_METRICS_DETAILED=false
